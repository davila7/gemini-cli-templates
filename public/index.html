<!DOCTYPE html>
<html>
<head>
  <title>Gemini CLI Analytics Dashboard</title>
  <style>
    :root {
      /* Gemini CLI color palette */
      --gemini-pink: #FF1493;
      --gemini-purple: #8A2BE2;
      --gemini-blue: #1E90FF;
      --gemini-cyan: #00CED1;
      --terminal-bg: #0a0a0a;
      --card-bg: #1a1a1a;
      --terminal-text: #00ff00;
      --accent-text: #ffffff;
      --dim-text: #888888;
      --border-color: #333333;
      --orange-accent: #ff6b35;
    }

    [data-theme="light"] {
      --terminal-bg: #f5f5f5;
      --card-bg: #ffffff;
      --terminal-text: #2d5a2d;
      --accent-text: #333333;
      --dim-text: #666666;
      --border-color: #e0e0e0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body { 
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      background: var(--terminal-bg);
      color: var(--accent-text);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Header */
    .header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      background: var(--terminal-text);
      border-radius: 50%;
      box-shadow: 0 0 10px var(--terminal-text);
    }

    .header h1 {
      font-size: 1.5em;
      font-weight: 700;
      background: linear-gradient(135deg, var(--gemini-pink), var(--gemini-purple), var(--gemini-blue), var(--gemini-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
    }

    .version {
      background: var(--card-bg);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75em;
      color: var(--dim-text);
      border: 1px solid var(--border-color);
    }

    .header-subtitle {
      color: var(--dim-text);
      font-size: 0.9em;
      margin-top: 4px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 8px 16px;
      background: var(--card-bg);
      color: var(--accent-text);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.85em;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--gemini-cyan);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }

    .btn.primary {
      background: linear-gradient(135deg, var(--gemini-purple), var(--gemini-blue));
      border-color: var(--gemini-blue);
    }

    .btn.primary:hover {
      background: linear-gradient(135deg, var(--gemini-pink), var(--gemini-cyan));
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
    }

    .container {
      padding: 24px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Main metrics grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .metric-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--gemini-pink), var(--gemini-purple), var(--gemini-blue), var(--gemini-cyan));
    }

    .metric-card:hover {
      border-color: var(--gemini-cyan);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .metric-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .metric-title {
      color: var(--dim-text);
      text-transform: uppercase;
      font-size: 0.8em;
      font-weight: 600;
      letter-spacing: 0.1em;
    }

    .metric-value {
      font-size: 2.5em;
      font-weight: 900;
      background: linear-gradient(135deg, var(--gemini-cyan), var(--gemini-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
      line-height: 1;
    }

    .metric-details {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .metric-detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85em;
    }

    .metric-detail-label {
      color: var(--dim-text);
    }

    .metric-detail-value {
      color: var(--accent-text);
      font-weight: 600;
    }

    /* Current session section */
    .current-session {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .session-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .session-title {
      font-size: 1.2em;
      font-weight: 600;
      color: var(--accent-text);
    }

    .session-status {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(0, 255, 0, 0.2);
      border: 1px solid var(--terminal-text);
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--terminal-text);
    }

    .session-detail {
      margin-bottom: 16px;
      color: var(--gemini-cyan);
      font-weight: 600;
    }

    .session-progress {
      margin-top: 16px;
    }

    .progress-bar {
      background: var(--border-color);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--terminal-text), var(--gemini-cyan));
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 0.8em;
      color: var(--dim-text);
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 24px;
    }

    .tab-button {
      padding: 12px 24px;
      background: none;
      border: none;
      color: var(--dim-text);
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      transition: all 0.3s ease;
      border-bottom: 2px solid transparent;
    }

    .tab-button:hover {
      color: var(--accent-text);
    }

    .tab-button.active {
      color: var(--gemini-cyan);
      border-bottom-color: var(--gemini-cyan);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Loading and empty states */
    .loading {
      display: inline-block;
      animation: pulse 1.5s ease-in-out infinite alternate;
    }

    @keyframes pulse {
      from { opacity: 1; }
      to { opacity: 0.5; }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--dim-text);
    }

    .empty-state h3 {
      color: var(--accent-text);
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .empty-state p {
      margin-bottom: 20px;
    }

    .empty-state ol {
      text-align: left;
      max-width: 500px;
      margin: 20px auto;
    }

    .empty-state li {
      margin: 10px 0;
      padding: 5px 0;
    }

    .empty-state code {
      background: var(--card-bg);
      padding: 8px 12px;
      border-radius: 4px;
      font-family: inherit;
      color: var(--terminal-text);
      border: 1px solid var(--border-color);
      display: inline-block;
      margin: 5px 0;
    }

    /* Traces styling */
    .trace-item {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin: 12px 0;
      padding: 16px;
      border-left: 4px solid var(--gemini-blue);
      transition: all 0.3s ease;
    }

    .trace-item:hover {
      border-left-color: var(--gemini-cyan);
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
    }

    .trace-id {
      color: var(--gemini-cyan);
      font-weight: 600;
      font-family: inherit;
      font-size: 0.9em;
    }

    .span-item {
      background: rgba(255, 255, 255, 0.05);
      margin: 6px 0;
      padding: 10px;
      border-radius: 4px;
      font-size: 0.85em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .span-operation {
      color: var(--gemini-cyan);
      font-weight: 600;
    }

    .span-duration {
      color: var(--dim-text);
      font-size: 0.8em;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }
      
      .header-right {
        width: 100%;
        justify-content: space-between;
      }
      
      .container {
        padding: 16px;
      }
      
      .metrics-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .metric-value {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-left">
      <div class="status-dot"></div>
      <div>
        <h1>Gemini CLI Analytics Dashboard</h1>
        <div class="version">v1.0.0</div>
        <div class="header-subtitle">Real-time monitoring and analytics for Gemini CLI sessions</div>
        <div class="header-subtitle" id="last-update">last update: <span id="timestamp"></span></div>
      </div>
    </div>
    <div class="header-right">
      <div class="header-actions">
        <button class="btn" onclick="toggleTheme()" id="theme-toggle">üåô Dark</button>
        <a class="btn" href="https://github.com/davila7/gemini-cli-templates" target="_blank">‚≠ê Star on GitHub</a>
      </div>
    </div>
  </div>
  
  <div class="container">
    <!-- Controls Section -->
    <div style="display: flex; justify-content: flex-end; margin-bottom: 24px; gap: 12px;">
      <button class="btn" onclick="refreshData()">üîÑ Refresh</button>
      <button class="btn" onclick="exportData()">üìä Export</button>
    </div>

    <!-- Main Metrics Grid -->
    <div class="metrics-grid" id="main-metrics">
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-title">Total Sessions</div>
        </div>
        <div class="metric-value" id="total-sessions">0</div>
        <div class="metric-details">
          <div class="metric-detail-row">
            <span class="metric-detail-label">This Week:</span>
            <span class="metric-detail-value" id="sessions-week">0</span>
          </div>
          <div class="metric-detail-row">
            <span class="metric-detail-label">Active:</span>
            <span class="metric-detail-value" id="sessions-active">0</span>
          </div>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-title">Total Tools</div>
        </div>
        <div class="metric-value" id="total-tools">0</div>
        <div class="metric-details">
          <div class="metric-detail-row">
            <span class="metric-detail-label">This Week:</span>
            <span class="metric-detail-value" id="tools-week">0</span>
          </div>
          <div class="metric-detail-row">
            <span class="metric-detail-label">Success Rate:</span>
            <span class="metric-detail-value" id="tools-success">0%</span>
          </div>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-title">Total Tokens</div>
        </div>
        <div class="metric-value" id="total-tokens">0</div>
        <div class="metric-details">
          <div class="metric-detail-row">
            <span class="metric-detail-label">Input:</span>
            <span class="metric-detail-value" id="tokens-input">0</span>
          </div>
          <div class="metric-detail-row">
            <span class="metric-detail-label">Output:</span>
            <span class="metric-detail-value" id="tokens-output">0</span>
          </div>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-title">Total API Calls</div>
        </div>
        <div class="metric-value" id="total-apis">0</div>
        <div class="metric-details">
          <div class="metric-detail-row">
            <span class="metric-detail-label">Avg Duration:</span>
            <span class="metric-detail-value" id="api-duration">0ms</span>
          </div>
          <div class="metric-detail-row">
            <span class="metric-detail-label">Success Rate:</span>
            <span class="metric-detail-value" id="api-success">0%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Current Session -->
    <div class="current-session" id="current-session" style="display: none;">
      <div class="session-header">
        <div class="session-title">Current Session</div>
        <div class="session-status">
          <div class="status-badge">
            <span>‚óè</span>
            <span>Active</span>
          </div>
        </div>
      </div>
      <div class="session-detail" id="session-detail">Session ID: Loading...</div>
      <div class="session-progress">
        <div class="progress-bar">
          <div class="progress-fill" id="session-progress" style="width: 0%"></div>
        </div>
        <div class="progress-text">
          <span id="session-time">0h 0m remaining</span>
          <span id="session-estimate">0/0 est.</span>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-button active" onclick="showTab('overview')">Overview</button>
      <button class="tab-button" onclick="showTab('traces')">Traces</button>
    </div>
    
    <div id="overview" class="tab-content active">
      <div id="metrics-content" class="loading">Loading metrics...</div>
    </div>
    
    <div id="traces" class="tab-content">
      <div id="traces-content"></div>
    </div>
  </div>

  <script>
    let metricsData = [];
    let tracesData = [];

    function updateTimestamp() {
      document.getElementById('timestamp').textContent = new Date().toLocaleTimeString();
    }

    function toggleTheme() {
      const body = document.body;
      const themeToggle = document.getElementById('theme-toggle');
      
      if (body.getAttribute('data-theme') === 'light') {
        body.removeAttribute('data-theme');
        themeToggle.innerHTML = 'üåô Dark';
        localStorage.setItem('theme', 'dark');
      } else {
        body.setAttribute('data-theme', 'light');
        themeToggle.innerHTML = '‚òÄÔ∏è Light';
        localStorage.setItem('theme', 'light');
      }
    }

    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');
      const themeToggle = document.getElementById('theme-toggle');
      
      if (savedTheme === 'light') {
        document.body.setAttribute('data-theme', 'light');
        themeToggle.innerHTML = '‚òÄÔ∏è Light';
      } else {
        themeToggle.innerHTML = 'üåô Dark';
      }
    }

    function showTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
      
      // Load content for the selected tab
      if (tabName === 'overview') {
        fetchMetrics();
      } else if (tabName === 'traces') {
        loadTraces();
      }
    }

    function refreshData() {
      updateTimestamp();
      fetchMetrics();
      loadTraces();
    }

    function exportData() {
      const data = {
        metrics: metricsData,
        traces: tracesData,
        timestamp: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `gemini-cli-data-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function updateMainMetrics(metrics) {
      // Calculate aggregated metrics
      const sessionIds = [...new Set(metrics.map(m => m.sessionId))];
      const totalSessions = sessionIds.length;
      
      // Get metrics for tools
      const toolMetrics = metrics.filter(m => m.name && m.name.includes('tool'));
      const totalTools = toolMetrics.reduce((sum, m) => sum + m.value, 0);
      
      // Get token metrics
      const tokenMetrics = metrics.filter(m => m.name && m.name.includes('token'));
      const inputTokens = tokenMetrics.filter(m => m.attributes?.type === 'input').reduce((sum, m) => sum + m.value, 0);
      const outputTokens = tokenMetrics.filter(m => m.attributes?.type === 'output').reduce((sum, m) => sum + m.value, 0);
      const totalTokens = inputTokens + outputTokens;
      
      // Get API metrics from traces
      const apiCalls = tracesData.reduce((sum, trace) => sum + trace.spans.filter(s => s.operationName.includes('gemini.api')).length, 0);
      const avgDuration = tracesData.length > 0 ? Math.round(tracesData.reduce((sum, trace) => {
        const apiSpans = trace.spans.filter(s => s.operationName.includes('gemini.api'));
        return sum + apiSpans.reduce((spanSum, span) => spanSum + span.duration, 0) / (apiSpans.length || 1);
      }, 0) / tracesData.length / 1000) : 0;

      // Update DOM
      document.getElementById('total-sessions').textContent = totalSessions;
      document.getElementById('sessions-week').textContent = totalSessions; // Simplified for demo
      document.getElementById('sessions-active').textContent = sessionIds.length > 0 ? '1' : '0';
      
      document.getElementById('total-tools').textContent = totalTools.toLocaleString();
      document.getElementById('tools-week').textContent = totalTools.toLocaleString(); // Simplified for demo
      document.getElementById('tools-success').textContent = '100%'; // Simplified for demo
      
      document.getElementById('total-tokens').textContent = totalTokens.toLocaleString();
      document.getElementById('tokens-input').textContent = inputTokens.toLocaleString();
      document.getElementById('tokens-output').textContent = outputTokens.toLocaleString();
      
      document.getElementById('total-apis').textContent = apiCalls.toLocaleString();
      document.getElementById('api-duration').textContent = `${avgDuration}ms`;
      document.getElementById('api-success').textContent = '100%'; // Simplified for demo

      // Show current session if there are active sessions
      if (sessionIds.length > 0) {
        const currentSession = document.getElementById('current-session');
        currentSession.style.display = 'block';
        document.getElementById('session-detail').textContent = `Session ID: ${sessionIds[0].substring(0, 8)}...`;
      }
    }

    async function fetchMetrics() {
      try {
        const response = await fetch('/api/metrics');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        const data = await response.json();
        metricsData = data.metrics || [];
        
        // Update main metrics dashboard
        updateMainMetrics(metricsData);
        
        const metricsDiv = document.getElementById('metrics-content');
        
        if (!data.metrics || data.metrics.length === 0) {
          metricsDiv.innerHTML = `
            <div class="empty-state">
              <h3>üìä No metrics detected</h3>
              <p>Execute Gemini CLI commands with telemetry enabled:</p>
              <code>echo "Hello World" | gemini --telemetry --model gemini-2.5-flash</code>
              <br><br>
              <button onclick="fetchMetrics()" class="btn">
                üîÑ Refresh Metrics
              </button>
            </div>
          `;
          return;
        }
        
        let html = `<div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <span class="status-badge">‚óè ${data.total} metrics found</span>
          </div>
          <button onclick="fetchMetrics()" class="btn">üîÑ Refresh</button>
        </div>`;
        
        // Group metrics by name
        const metricsByName = {};
        data.metrics.forEach(metric => {
          if (!metricsByName[metric.name]) {
            metricsByName[metric.name] = [];
          }
          metricsByName[metric.name].push(metric);
        });
        
        // Display metrics
        for (const [name, metrics] of Object.entries(metricsByName)) {
          // Group by unique attribute combinations
          const uniqueMetrics = [];
          metrics.forEach(metric => {
            const key = JSON.stringify(metric.attributes || {});
            if (!uniqueMetrics.find(m => JSON.stringify(m.attributes || {}) === key)) {
              uniqueMetrics.push(metric);
            }
          });
          
          html += `<div class="section">`;
          html += `<h3 style="margin: 0 0 10px 0; color: var(--terminal-text); text-transform: uppercase;">${name}</h3>`;
          html += `<p style="margin: 0 0 15px 0; color: var(--dim-text); font-size: 14px;">${metrics[0].description}</p>`;
          
          // Show each unique metric variant
          uniqueMetrics.forEach(metric => {
            const attrs = metric.attributes || {};
            let attributeText = '';
            
            // Build attribute display
            Object.keys(attrs).forEach(key => {
              if (key !== 'sessionId') {
                attributeText += `<span class="status-badge" style="margin: 2px;">${key}: ${attrs[key]}</span> `;
              }
            });
            
            html += `
              <div class="metric-item">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div class="metric-value">${metric.value.toLocaleString()}</div>
                    <div style="margin: 8px 0;">${attributeText}</div>
                  </div>
                  <div style="text-align: right; font-size: 11px; color: var(--dim-text);">
                    <div style="color: var(--terminal-text);">Session: ${metric.sessionId.substring(0, 8)}...</div>
                    <div>${new Date(metric.timestamp).toLocaleString()}</div>
                  </div>
                </div>
              </div>
            `;
          });
          
          html += `</div>`;
        }
        
        metricsDiv.innerHTML = html;
        
      } catch (error) {
        document.getElementById('metrics-content').innerHTML = `
          <div class="empty-state">
            <h3>‚ùå Error loading metrics</h3>
            <p style="color: #ff6666;">${error.message}</p>
            <button onclick="fetchMetrics()" class="btn">
              üîÑ Try Again
            </button>
          </div>
        `;
      }
    }

    async function fetchServices() {
      try {
        const response = await fetch('/api/services');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        const data = await response.json();
        return data.data || [];
      } catch (error) {
        console.error('Error fetching services:', error);
        return [];
      }
    }

    async function fetchTraces(service = '') {
      try {
        const url = service ? `/api/traces?service=${service}` : '/api/traces';
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        tracesData = data.data || [];
        
        const tracesDiv = document.getElementById('traces-content');
        tracesDiv.innerHTML = '';

        if (!data.data || data.data.length === 0) {
          tracesDiv.innerHTML = `<div class="empty-state"><p>No traces found${service ? ` for ${service} service` : ''}</p></div>`;
          return;
        }

        let html = `<div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <span class="status-badge">‚óè ${data.data.length} traces found</span>
            <span style="margin-left: 10px; color: var(--dim-text);">Service: ${service}</span>
          </div>
          <button onclick="loadTraces()" class="btn">üîÑ Refresh</button>
        </div>`;

        for (const trace of data.data) {
          html += `
            <div class="trace-item">
              <h4 style="color: var(--accent-text); margin-bottom: 10px; font-size: 1em;">
                üîó Trace ID: <span class="trace-id">${trace.traceID.substring(0, 16)}...</span>
              </h4>
              <div style="margin-left: 0;">
                ${trace.spans.map(span => `
                  <div class="span-item">
                    <div class="span-operation">${span.operationName}</div>
                    <div class="span-duration">${(span.duration / 1000).toFixed(2)}ms</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        tracesDiv.innerHTML = html;
        
        // Update main metrics with trace data
        updateMainMetrics(metricsData);
        
      } catch (error) {
        document.getElementById('traces-content').innerHTML = `
          <div class="empty-state">
            <h3>‚ùå Error loading traces</h3>
            <p style="color: #ff6666;">${error.message}</p>
            <button onclick="loadTraces()" class="btn">üîÑ Try Again</button>
          </div>
        `;
      }
    }

    async function loadTraces() {
      const services = await fetchServices();
      const tracesDiv = document.getElementById('traces-content');
      
      if (services.length === 0) {
        tracesDiv.innerHTML = `
          <div class="empty-state">
            <h3>‚ö†Ô∏è No telemetry services detected</h3>
            <p>To see Gemini CLI traces:</p>
            <ol>
              <li><strong>Enable telemetry:</strong><br>
                  <code>gemini --telemetry "analyze this project"</code></li>
              <li><strong>Or start telemetry service:</strong><br>
                  <code>cd gemini-cli && npm run telemetry</code></li>
              <li><strong>Refresh this page</strong></li>
            </ol>
            <p><strong>Jaeger UI:</strong> <a href="http://localhost:16686" target="_blank" style="color: var(--gemini-cyan);">http://localhost:16686</a></p>
          </div>
        `;
        return;
      }

      console.log('Available services:', services);
      
      // Show all available services
      tracesDiv.innerHTML = `
        <div style="margin: 20px 0;">
          <h3 style="color: var(--terminal-text);">üõ†Ô∏è Available Services:</h3>
          <div style="margin: 10px 0;">
            ${services.map(s => `<span class="status-badge" style="margin: 5px;">${s}</span>`).join('')}
          </div>
          <p class="loading">Loading traces...</p>
        </div>
      `;
      
      // Try to find gemini-cli first, then any non-jaeger service, otherwise use first service
      const targetService = services.find(s => s.includes('gemini')) || 
                           services.find(s => !s.includes('jaeger')) || 
                           services[0];
      
      console.log('Using service:', targetService);
      fetchTraces(targetService);
    }

    // Initialize with metrics tab
    async function init() {
      loadTheme();
      updateTimestamp();
      fetchMetrics();
      loadTraces();
      
      // Auto-refresh every 30 seconds
      setInterval(() => {
        const activeTab = document.querySelector('.tab-content.active');
        if (activeTab && activeTab.id === 'overview') {
          fetchMetrics();
        } else if (activeTab && activeTab.id === 'traces') {
          loadTraces();
        }
        updateTimestamp();
      }, 30000);
    }

    init();
  </script>
</body>
</html>